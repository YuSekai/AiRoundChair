# 连续讨论功能测试指南

## 功能概述

已成功为 IntelliRound 添加了连续讨论功能，现在用户可以：

1. **基于共识继续讨论**：在完成一轮讨论后，可以基于达成的共识进行更深入的探讨
2. **智能问题建议**：系统会根据讨论内容自动生成后续问题建议
3. **自定义深入方向**：用户可以输入自己感兴趣的深入探讨方向
4. **自动议题生成**：AI 可以基于前一轮共识自动生成新的讨论议题

## 使用流程

### 基本使用流程
1. **开始初始讨论**：输入议题，生成角色，进行正常讨论
2. **等待共识完成**：讨论完成后，系统会显示最终共识
3. **点击继续讨论**：在共识显示后，会出现"继续深入讨论"按钮
4. **选择深入方向**：
   - 从建议问题中选择一个
   - 输入自定义问题
   - 让AI自动生成新议题
5. **开始连续讨论**：系统会保持原有角色，基于新的议题继续讨论

### 高级功能
- **会话链接**：连续讨论会自动记录与前一轮讨论的关系
- **上下文传递**：AI角色会了解前一轮的共识内容
- **渐进深入**：支持多轮连续讨论，逐步深入分析问题

## 测试步骤

### 1. 基础功能测试
```
1. 启动应用：npm start
2. 输入简单议题：如"远程办公的优缺点"
3. 等待角色生成和讨论完成
4. 验证共识显示后出现"继续深入讨论"按钮
5. 点击按钮，查看建议问题是否合理
6. 选择一个问题或输入自定义问题
7. 验证新讨论是否基于前一轮共识
```

### 2. 连续讨论深度测试
```
1. 进行第一轮讨论
2. 基于共识进行连续讨论（第二轮）
3. 在第二轮完成后再次点击继续讨论（第三轮）
4. 验证多轮讨论的上下文连贯性
5. 测试导出功能是否包含完整的讨论历史
```

### 3. 边界情况测试
```
1. 测试空输入或无效输入的处理
2. 测试网络异常时的错误处理
3. 测试AI生成失败时的降级处理
4. 测试多次连续讨论的性能表现
```

## 技术实现要点

### 后端改进
1. **类型系统扩展**：在 `DebateSession` 接口中添加了连续讨论相关字段
2. **会话管理**：`DebateManager` 新增了生成后续问题和连续讨论议题的方法
3. **上下文传递**：`DebateEngine` 支持在提示中包含前一轮讨论的共识信息
4. **IPC通信**：主进程新增了处理连续讨论的IPC处理器

### 前端改进
1. **UI界面**：添加了连续讨论按钮和模态对话框
2. **交互逻辑**：实现了问题建议、自定义输入、自动生成等功能
3. **状态管理**：正确处理连续讨论的状态转换和数据更新
4. **用户体验**：添加了加载状态、错误处理和响应式设计

### 数据流设计
```
初始讨论 → 达成共识 → 生成建议问题 → 用户选择/输入 → 
生成新议题 → 开始连续讨论 → 传递上下文 → 继续深入分析
```

## 配置说明

连续讨论功能使用现有的AI配置，无需额外设置。建议：
- **超时设置**：建议30-60秒，确保有足够时间生成质量高的后续问题
- **模型选择**：推荐使用性能较好的模型（如qwen2.5:14b）以获得更好的问题生成质量
- **温度设置**：建议0.7左右，平衡创造性和一致性

## 故障排除

### 常见问题
1. **继续讨论按钮不显示**：确保讨论已完成且达成了共识
2. **建议问题生成失败**：检查AI连接和模型配置
3. **连续讨论启动失败**：验证前一轮讨论数据是否完整

### 调试方法
1. 查看控制台日志，了解详细的错误信息
2. 使用开发工具检查网络请求和响应
3. 验证AI模型连接和配置是否正确

## 未来优化方向

1. **智能话题演化**：基于讨论进展自动调整议题深度
2. **角色记忆增强**：让角色记住多轮讨论中的关键观点
3. **讨论路径可视化**：展示多轮讨论的逻辑关系和进展
4. **质量评估**：对连续讨论的质量进行自动评估和反馈